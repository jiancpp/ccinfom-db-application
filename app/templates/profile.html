{% extends "base.html" %}
{% block title %}Profile - KSync{% endblock %}

{% block content %}
    <header style="border-bottom: 3px solid #764ba2; padding-bottom: 10px; margin-bottom: 25px;">
        <h1 style="color: #764ba2; font-size: 2.5rem; margin-bottom: 5px;">
            ðŸ‘¤ {{ fan.First_Name }}'s Profile
        </h1>
        <p style="color: #555;">
            All your stats are sync'd up.
        </p>
    </header>

    <div class="grid" style="grid-template-columns: 1fr 1fr;">
        
        <div class="card">
            <h3 style="color: #4a4a4a; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                <i class="fa fa-user-circle-o"></i> Account Information
            </h3>
            
            <p><strong>Fan ID:</strong> ID{{ "%05d" | format(fan[0].Fan_ID) }}</p>
            <p><strong>Username:</strong> @{{ fan[0].Username }}</p>
            <p><strong>Full Name:</strong> {{ fan[0].First_Name }} {{ fan[0].Last_Name }}</p>
            <p><strong>Email:</strong> {{ fan[0].Email }}</p>
            <p><strong>Joined:</strong> <span class="date">{{ fan[0].Date_Joined }}</span></p>
        </div>

        <div class="card">
            <h3 style="color: #4a4a4a; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                <i class="fa fa-users"></i> Fanclub Memberships
            </h3>
            
            {% if memberships %}
                <div class="membership-list" style="display: flex; flex-direction: column; gap: 10px;">
                    {% for membership in memberships %}
                        <div style="background: #fcfcfc; padding: 12px 15px; border-radius: 8px; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600; color: #444;">
                                {{ membership.Fanclub_Name }}
                            </span>
                            <span class="badge" style="background: #d4edda; color: #155724; padding: 6px 10px;">
                                Joined {{ membership.Date_Joined.strftime('%b %Y') }}
                            </span>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p><i class="fa fa-frown-o fa-2x"></i></p>
                    <p>You haven't joined any fan clubs yet.</p>
                    <a href="{{ url_for('main_routes.fanclubs') }}" class="btn" style="margin-top: 10px;">Find a Fanclub</a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <div style="margin-top: 40px;">
        <h2><i class="fa fa-ticket"></i> Recent Ticket History</h2>

        {% if purchases %}
            <table class="styled-table">
                <thead style="background-color: #f8f9fa;">
                    <tr>
                        <th style="width: 30%;">Event</th>
                        <th style="width: 20%;">Tier</th>
                        <th style="width: 25%;">Purchase Date</th>
                        <th style="width: 25%;">Seat / Section</th>
                    </tr>
                </thead>
                <tbody>
                    {% for purchase in purchases %}
                        <tr>
                            <td>
                                <a href="{{ url_for('main_routes.view_ticket', ticket_id=purchase.Ticket_ID) }}" style="color: #764ba2; text-decoration: none;">
                                    {{ purchase.Event_Name }}
                                </a>
                            </td>
                            <td>
                                <span class="badge" style="background: #e9ecef; color: #333;">
                                    {{ purchase.Tier_Name }}
                                </span>
                            </td>
                            <td class="date-time-col" style="font-size: 0.9em;">
                                {{ purchase.Purchase_Date.strftime('%Y-%m-%d at %H:%M') }}
                            </td>
                            <td>
                                <span class="badge" style="background: #e9ecef; color: #333;">
                                {% if purchase.Seat_Row %}
                                    Seat {{ purchase.Seat_Row }}{{ purchase.Seat_Number }} - Section {{ purchase.Section_Name }}
                                {% else %}
                                    No reserved seat
                                {% endif %}
                                </span>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="empty-state">
                <p><i class="fa fa-calendar-o fa-2x"></i></p>
                <p>No ticket purchases found. Let's get you to an event!</p>
                <a href="{{ url_for('main_routes.events') }}" class="btn" style="margin-top: 10px;">Browse Events</a>
            </div>
        {% endif %}
    </div>

{% endblock %}
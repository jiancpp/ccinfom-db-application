{% extends "base.html" %}

{% block title %}Fanclubs - KSync{% endblock %}

{% block content %}
<header style="margin-bottom: 2rem;">
    <h1>ðŸ’– Fanclubs</h1>
    <p style="color: #666;">Explore and join fan communities for your favorite K-Pop artists.</p>
</header>

{% if fanclubs %}
    {% for artist_name, fanclub in fanclubs | groupby('artist_name') %}
        
        <h2 style="margin-top: 3rem; border-bottom: 2px solid #eee; padding-bottom: 0.5rem;">
            ðŸŽ¤ {{ artist_name }} Fanclubs
        </h2>

        <div class="fanclub-list-container" style="margin-bottom: 2rem;">
            {% for fanclub in fanclubs %}
                <div class="card fanclub-item-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                        
                        <div style="flex-grow: 1; min-width: 200px;">
                            <h3 style="margin-top: 0; margin-bottom: 0.25rem;">{{ fanclub.fanclub_name }}</h3>
                        </div>

                        <div style="display: flex; gap: 1rem; align-items: center; margin-top: 0.5rem;">
                            
                            <div class="badge" style="background: #e0f7fa; color: #00bcd4; white-space: nowrap; padding: 6px 14px;">
                                Members: {{ fanclub.member_count }}
                            </div>
                            
                            <a href="{{ url_for('main_routes.fanclub_details', fanclub_id=fanclub.fanclub_id) }}" class="btn btn-outline" style="padding: 8px 16px;">View Fanclub</a>
                            
                            {% if fanclub.is_member %}
                                <form method="POST" action="{{ url_for('main_routes.leave_fanclub', fanclub_id=fanclub.fanclub_id) }}" style="display: inline;">
                                    <button type="submit" 
                                            class="btn" 
                                            style="background-color: #d53f3f; padding: 10px 16px;">
                                        Leave Fanclub
                                    </button>
                                </form>
                            {% else %}
                                <form method="POST" action="{{ url_for('main_routes.join_fanclub', fanclub_id=fanclub.fanclub_id) }}" style="display: inline;">
                                    <button type="submit" 
                                            class="btn"
                                            style="padding: 10px 16px;">
                                        Join Fanclub
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
    {% endfor %}
{% else %}
    <div class="empty-state">
        <p>ðŸ˜” It looks like no fanclubs are available at the moment.</p>
        <p>Please check back later!</p>
    </div>
{% endif %}
{% endblock %}
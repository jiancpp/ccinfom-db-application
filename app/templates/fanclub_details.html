{% extends "base.html" %}

{% block title %}{{ fanclub[0].Fanclub_Name }} - KSync{% endblock %}

{% block content %}

    <div style="margin-bottom: 1.5rem;">
        <a href="{{ url_for('main_routes.fanclubs') }}" 
           class="btn btn-small btn-outline" 
           style="text-decoration: none; padding: 5px 12px; font-size: 0.85rem; color: #555;">
            &larr; Back to Fanclub List
        </a>
    </div>

    <div style="margin-bottom: 4rem; 
                display: flex; 
                justify-content: space-between; 
                align-items: flex-end; /* Align actions to the bottom of the title block */
                gap: 20px;">

        <div class="header-titles">
            <h1 style="color: #667eea; margin-top: 0.5rem; margin-bottom: 0.1rem; font-size: 3rem; white-space: nowrap;">
                ‚ú® {{ fanclub[0].Fanclub_Name }}
            </h1>
            
            <p style="font-size: 1.3rem; font-weight: 300; color: #555; margin-top: 0; white-space: nowrap;">
                {{ fanclub[0].Artist_Name }} Fan Community
            </p>
        </div>

        <div class="action-buttons" style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            
            {# View Members Button #}
            <a href="{{ url_for('main_routes.fanclub_members', fanclub_id=fanclub[0].Fanclub_ID) }}" 
               class="btn btn-outline" 
               style="padding: 8px 18px;  
                      font-weight: 500; font-size: 0.95rem;">
                View Fanclub Members &rarr;
            </a>

            {% if is_member[0] %}
                <form method="POST" action="{{ url_for('main_routes.leave_fanclub', fanclub_id=fanclub[0].Fanclub_ID) }}" style="display: inline;">
                    <button type="submit" 
                            class="btn btn-action-danger" 
                            style="background-color: #d53f3f; 
                                color: white; 
                                padding: 10px 22px; border-radius: 8px; font-size: 0.95rem; border: none; cursor: pointer;">
                        Leave Fanclub
                    </button>
                </form>
            {% else %}
                <form method="POST" action="{{ url_for('main_routes.join_fanclub', fanclub_id=fanclub[0].Fanclub_ID) }}" style="display: inline;">
                    <button type="submit" 
                            class="btn btn-action-primary" 
                            style="background-color: #667eea; 
                                color: white; 
                                padding: 10px 22px; border-radius: 8px; font-size: 0.95rem; border: none; cursor: pointer;">
                        Join Fanclub
                    </button>
                </form>
            {% endif %}
        </div>
    </div>
    
    <div class="main-content-flow" style="display: flex; flex-direction: column; gap: 4rem;">
        
        <section>
            <h2 style="color: #667eea; border-bottom: 2px solid #eee; padding-bottom: 0.5rem; margin-bottom: 2rem;">
                üõçÔ∏è Exclusive Merchandise ({{ event_merch_count[0].Merch_Count }})
            </h2>
            
            {% if merch_list %}
                <div class="merch-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 2rem;">
                    {% for merch in merch_list %}
                        <div class="merch-card" 
                             style="text-align: center; 
                                    padding: 1.5rem 1rem; 
                                    background: #fff; 
                                    border-radius: 12px; 
                                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);">
                        
                            <h5 style="margin-top: 0; margin-bottom: 0.5rem; color: #333; font-size: 1.1rem;">{{ merch.Merchandise_Name }}</h5>
                            <p style="color: #4CAF50; font-weight: 700; font-size: 1.2rem; margin-bottom: 1rem;">${{ merch.Merchandise_Price }}</p>

                            {% if merch.Quantity_Stock > 0 %}
                                <a href="{{ url_for('main_routes.add_to_cart', merchandise_id=merch.Merchandise_ID)}}" class="btn btn-small" 
                               style="background: #667eea; color: white; padding: 8px 15px; border-radius: 6px; font-weight: 500;">Add to Cart üõçÔ∏è</a>
                            {% else %}
                                <button class="btn btn-small" 
                               style="background: #667eea; color: white; padding: 8px 15px; border-radius: 6px; font-weight: 500;">
                                    Sold Out üö´
                                </button>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state" style="padding: 1.5rem; background: #fff8e1; border-radius: 8px;">
                    <p style="color: #b38800;">No exclusive merchandise available right now. Check back soon!</p>
                </div>
            {% endif %}
        </section>

        <section>
            <div style="
                display: flex; 
                justify-content: space-between; 
                align-items: center; 
                margin-bottom: 2rem;
                padding-bottom: 0.5rem;
                border-bottom: 2px solid #eee; /* Move border from H2 to DIV */
            ">
                
                <h2 style="color: #667eea; margin: 0; padding: 0;">
                    üìÖ Upcoming Fanclub Events ({{ event_merch_count[0].Event_Count }})
                </h2>
                
                <a href="{{ url_for('main_routes.create_fanclub_event', fanclub_id=fanclub[0].Fanclub_ID) }}" class="btn">
                    <i class="fa fa-plus-circle"></i> Create Event
                </a>
            </div>
            
            {% if event_list %}
                <div class="event-list">
                    {% for event in event_list %}
                        <div class="event-item-card" 
                             style="margin-bottom: 1.5rem; padding: 1.5rem; 
                                    background: #f0f8ff; 
                                    border-radius: 10px; 
                                    border-left: 6px solid #00bcd4; 
                                    display: flex; justify-content: space-between; align-items: center; 
                                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);">
                            <div style="flex-grow: 1;">
                                <h4 style="margin-top: 0; margin-bottom: 0.25rem; color: #333;">{{ event.Event_Name }}</h4>
                                <p style="color: #555; margin: 0; font-weight: 500;">
                                    {% if event.Start_Date != event.End_Date %}
                                        <span class="date">{{ event.Start_Date }}</span> to 
                                        <span class="date">{{ event.End_Date }}</span>
                                    {% else %}
                                        <span class="date">{{ event.Start_Date }}</span>
                                    {% endif %}
                                </p>
                            </div>
                            {# Details Button #}
                            <a href="{{ url_for('main_routes.buy_ticket', event_id=event.Event_ID) }}" class="btn btn-small btn-primary" 
                               style="background: #00bcd4; color: white; padding: 10px 18px; border-radius: 6px; font-weight: 500;">Buy Tickets</a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state" style="padding: 1.5rem; background: #fff8e1; border-radius: 8px;">
                    <p style="color: #b38800;">No upcoming fanclub-exclusive events scheduled. Stay tuned!</p>
                </div>
            {% endif %}
        </section>
        
    </div>

{% endblock %}